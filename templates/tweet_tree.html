{% extends "layout.html" %}
{% block title %}tweet ID: {{tweet_id}} reply tree{% endblock %}
{% block body %}
<style>
#TweetID_{{tweet_id}} {
	background-color: #ffffdd !important;
	margin:15px;
	padding:15px;
}
</style>
<script>
// 最後に読み込んだtweetのUnixTimeを保存しておきます。
// 負の値の場合は何も読み込んでいない事になるはずです
var lastReadUnixTime = -1;
// 一度に読み込むtweetの数を指定します
var readTweetNum = 10;
// サーバから読みだしたdataを使って、lastReadUnixTime を更新します
function LastReadUnixTimeUpdate(data)
{
	if(data.length <= 0){
		return;
	}
	target_tweet = data[data.length - 1];
	if('unix_time' in target_tweet){
		lastReadUnixTime = target_tweet['unix_time'];
	}
}
// lastReadUnixTime を使って、その続きのtweetを読み込みます。
function LoadTweets(func){
	StartReadTweets('/tweet/{{tweet_id}}_tree.json'
			, "#Tweet_text"
			, readTweetNum
			, lastReadUnixTime
			, function(data) {
				LastReadUnixTimeUpdate(data);
				if(func){
					func(data);
				}
			} );
}

// ページの読み込みが終わった時点で起動するfunction をjQueryから呼び出しています。
$(document).ready(
	function(){
		// tweetはページが読み込まれた後に読み込みを開始します。
		// 最初は now loading... と書いてあるので、読み込みが終わった時点で空文字に上書きします。
		LoadTweets(function() { $('#Tweet_text').html("<div></div>"); });
	});

</script>
<h2>tweet ID: {{ tweet_id }} reply tree</h2>
  {% if error %}<p class="error"><strong>Error:</strong>{{ error }}</p>{% endif %}
  <div id="Tweet_text">
	  now loading...
  </div>
{% endblock %}
